GMT命令之很有用但是却不常用的psimage
#####################################

:date: 2013-10-22 00:31
:author: SeisMan
:category: GMT
:tags: GMT命令, 图像, GMT4
:slug: gmt-psimage
:summary: 介绍psimage命令的语法.

.. contents::

psimage是个不太常用的命令，其主要功能是将一个图像文件直接绘制到当前地图中去。本文介绍一下psimage的基本语法，接下来的两篇博文介绍一下该命令的一些特殊用途（只是一些想法，具体能否实现还得再测试）。

语法
====

::

    usage: psimage <imagefile> [-E<dpi> or -W[-]<width>[/<height>]] 
        [-C<xpos>/<ypos>[/<justify>]] [-F<pen>] [-G[b|f|t]<color>] [-I] [-K] [-M] 
        [-N<nx>[/<ny>]] [-O] [-P] [-U[<just>/<dx>/<dy>/][c language="|<label>"][/c]]
        [-V] [-X[a|c|r]<x_shift>[u]] [-Y[a|c|r]<x_shift>[u]] [-c<ncopies>]

输入文件
========

psimage可以处理的图像文件包括EPS文件和1、8、24或32位Sun光栅文件。光栅文件平常不太用；需要注意的是，这里使用的是EPS文件而不是PS文件！（当然二者可以通过ps2raster命令很方便的进行转换）。

选项
====

标准选项有-K、-O、-P、-U、-V、-X、-Y、-c，不多说。

控制图像尺寸-E和-W
------------------

-E和-W选项可以用于控制待插入图像的尺寸，可以任意缩放。-E和-W任选其一即可。

-  -E：设置图像的dpi；由于EPS文件的点数已经固定，因而这里dpi越大，图看上去越小；
-  -W：设置图像在当前绘图坐标系中的宽度（和高度）；若未指定高度，则保持原横纵比；若宽度为负值，则取其绝对值，然后。。。（没看懂，也没看出区别）

觉得-W选项更加简单明了，更好用。需要注意的是，一般绘图-JX10c中的10cm指的是绘图框架的宽度，不包括周围的注释以及标题，而这里的-W包含了注释和标题所占的宽度，实际上-W是读取了文件中的BoundingBox的范围来进行缩放的。

位置控制-C
----------

设置图像在当前绘图中相对于当前原点的位置。默认值为0/0/BL，即图像的左下角位于当前绘图的原点处。-X和-Y选项也可以控制图像位置，但是我觉得-C选项更好用，有两个理由：

#. -C提供了对齐方式选项，更加灵活，一般的BL对齐方式是常用选择；
#. 使用-C选项不会对当前绘图的原点位置进行修改，而使用-X、-Y选项原点位置会被修改。

其他选项
--------

-  -F：该选项可以给图像加入一个边框，还可以设置边框的画笔属性；
-  -M：将彩图转换为黑白灰度图；
-  -N：将图像在x和y方向重复nx和ny次，常用于用小图构建pattern。

对于1位Sun光栅文件（即黑白图），有如下选项：

-  -Gb：设置背景色（即原图中的白色像素点），若颜色为“-”，则背景色为透明；
-  -Gf：设置前景色（即原图中的黑色像素点），若颜色为“-”，则前景色为透明；
-  -I：黑变白，白变黑；

对于8、24、32位光栅文件，有如下选项：

-  -Gt：设置光栅文件中的某种颜色为透明色。

备注和说明
==========

**Q1：如何获取EPS文件？**

**A1：**\ 对于GMT生成的PS文件，可以直接使用ps2raster命令转换成EPS文件，命令如下：

::

    ps2raster -A -P -Te image.ps

其中-A对图像做切边，这个很重要！-P选项是对图像进行旋转，这个看具体需求；-Te选项指定输入格式为EPS；

对于其他软件产生的ps文件，由于不符合GMT的标准，所以很大程序上ps2raster无法进行转换，可以考虑使用ps2eps或者convert命令。

**Q2：EPS文件与PS文件有什么区别？**

**A2：**\ 印象中有看到过，EPS文件不包含PS文件中的部分危险指令，因而更安全。对于GMT来说，ps2raster转换生成的EPS文件和原PS文件几乎没有区别（EPS文件中缺少了几行）。

**Q3：psimage生成的图是矢量图还是位图？**

**A3：**\ psimage生成了PS代码，所以最终成图是矢量图。从PS代码中可以看到，psimage大概只是把EPS的代码做了简单修改就直接放入了新生成的PS文件中，所以EPS文件里的图像在新生成的PS文件中依然是矢量的。

**Q4：psimage命令在什么情况下会用到？**

**A4：**\ 目前想到两个可能的用途，一个是以前博文曾经试图解决的图像合并问题，另一个是制作复杂公式的问题。这两个问题会在接下来的两篇博文中试着解决。
