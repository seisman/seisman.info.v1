用SAC快速拾取震相
#################

:date: 2016-02-19
:author: SeisMan
:category: SAC
:tags: SAC技巧
:slug: faster-ppk

SAC中的 ``plotpk`` 命令，可以用于拾取震相到时，用起来还算是比较简单方便。拾取震相时通常需要按下 ``T`` 和某个数字，有时还需要按下 ``B`` 和 ``N`` 进行上下翻页。

但当有大量波形数据需要拾取震相时， ``ppk`` 的效率就很难提升上去。以标记到时T0为例，效率低的原因在于：

#. 如果是用一只手指敲键盘，在敲完 ``T`` 之后，需要去找 ``0`` ，而由于各个数字键离得相对比较近，稍不认真就会敲错，而 ``ppk`` 中一旦敲错，就无法撤销，会造成更多的麻烦；
#. 如果使用多根手指敲键盘，比如可以小拇指放在 ``T`` 上，食指放在 ``0`` 上，这样不用看键盘也可以放心地敲。但是由于两个键之间的距离有些远，手的姿势可能会比较别扭，更何况在拾取震相的时候还经常需要按 ``B`` 和 ``N`` ，所以手指会离开 ``T`` 和 ``0`` 。

如果可以把按键 ``T`` 省略，按 ``0`` 就拾取到时T0，按 ``1`` 就拾取到时T1，这样一方面拾取到时时可以少按一个键，另一方面，也不必为了 ``T`` 和数字的固定搭配而让手指一直保持一个不舒服的姿势，效率应该可以提高不少。

因而，对 ``ppk`` 的源码做了微小的改动，使得 **只按下数字键就可以拾取震相到时** 。需要说明几点：

#. 使用 ``T`` 和数字键依然可以拾取震相到时，不受影响
#. 原始代码中按下数字键被用来定义震相质量，但因为这一功能极少使用，所以修改后的代码为了拾取震相的便利性而废弃了震相质量这一功能
#. SAC的协议上应该是不允许私自修改SAC源码的，因而这里只是给出了补丁文件，用户需要自行打补丁并重新编译源码
#. 该补丁仅适用于SAC v101.6a，其他版本未知

补丁下载： `fix-ppk.patch <http://7j1zxm.com1.z0.glb.clouddn.com/downloads/fix-ppk.patch>`_

先下载补丁文件，然后操作如下::

    tar -xvf sac-101.6a_source.tar.gz      # 解压SAC源码
    mv fix-ppk.patch sac-101.6a/src/gam    # 复制补丁到 sac-101.6a/src/gam 目录中
    cd sac-101.6a/src/gam                  # 切换到 sac-101.6a/src/gam 目录中
    patch -p0 < fix-ppk.patch              # 打补丁以修改 xppk.c 源码
    rm fix-ppk.patch                       # 删除补丁

然后按照常规的方法对源码进行重新编译即可。

PS：在ppk模式下单击鼠标，相当于敲键 ``L`` ，此时会在图上显示当前点的X和Y值，所以如果可以通过简单的单击就标记到时，应该会更高效。但目前还没有实现该功能，一方面是涉及到一些技术细节，另一方面是单击操作太容易发生，标记到时是变得简单了，但误标记也变得容易发生了。
